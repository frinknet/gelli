#!/gelli/bin/env sh

{
  getent passwd "$UID" || adduser -u "$UID" -g "$GID" -h "/work/.$BIN" -D "$BIN"
  getent group "$GID" || addgroup -g "$GID" "$BIN"
  echo ".*" > /work/.$BIN/.gitignore
} > /dev/null 2>&1

[ -f ".env" ] && source .env
#[ -f ".$BIN/bin/env" ] && ln -sf "$PWD/.$BIN/bin/env" "/gelli/bin/env"

CMD="$(alias "$BIN-$1" 2>/dev/null | cut -d\' -f2)"

[ -z "$CMD" ] && CMD="$RUN/bin/help"

shift || true

if [ "$(id -u)" -eq 0 ]; then
  exec su "$(getent passwd "$UID" | cut -d: -f1)" -c "$CMD" "$@ || error UNKNOWN COMMAND: $1 >&2"
else
  exec "$CMD" "$@ || error UNKNOWN COMMAND: $1 >&2"
fi

