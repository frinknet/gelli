#!/gelli/bin/env sh

{
  getent group "$GID" || groupadd -g "$GID" gelli
  getent passwd "$UID" || useradd -u "$UID" -g "$GID" -m gelli
} > /dev/null

[ -f ".env" ] && source .env
[ "$1" = "shell" ] && exec sh "$@"
[ "$1" = "version" ] && exec cat /etc/VERSION

CMD="${DIR}/gelli-${1:-help}"

shift || true

[ -f "$CMD" ] && exec su $(getent passwd "$UID" | cut -d: -f1) -c "$CMD" "$@" || error UNKNOWN COMMAND: $1 >&2
