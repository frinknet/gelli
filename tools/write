#!/usr/bin/env bash
set -euo pipefail

# DEF: {"name":"write","description":"Write content to file and commit to git","parameters":{"type":"object","properties":{"filename":{"type":"string","description":"File path to write"},"contents":{"type":"string","description":"File contents"},"comment":{"type":"string","description":"Git commit message"}},"required":["filename","contents","comment"]}}

filename=$(jq -r '.filename' <<< "$1")
contents=$(jq -r '.contents' <<< "$1")
comment=$(jq -r '.comment' <<< "$1")

mkdir -p "$(dirname "$filename")"
printf '%s' "$contents" > "$filename"

git add "$filename"
git commit -m "$comment" || echo "Warning: commit failed"

echo "âœ“ Written to $filename and committed: $comment"
