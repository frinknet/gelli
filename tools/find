#!/usr/bin/env sh
set -eu

# DEF: {"name":"files","description":"Find files in codebase or directory using glob patterns","parameters":{"type":"object","properties":{"pattern":{"type":"string","description":"Filename pattern to search"},"dir":{"type":"string","description":"Directory to search","default":"."}},"required":["pattern"]}}

pat="$(echo "${1:-"{}"}" | jq -r '.pattern // empty')"
dir="$(echo "${1:-"{}"}" | jq -r '.dir // "."')"

[ ! -d "$dir" ] && { echo "Error: directory not found"; exit 1; }
[ -z "$pat" ] && { echo "Error: empty pattern"; exit 1; }

find "$dir" -iname "*$filename*" -type f 2>/dev/null | head -20
