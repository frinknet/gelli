#!/usr/bin/env sh
set -e

MODEL=${1:-${GELLI_MODEL:-Qwen/Qwen2.5-0.5B-Instruct}}
shift || true
LORAS=${*:-${GELLI_LORAS:-}}
PORT=${GELLI_PORT:-7771}
CONTEXT=${GELLI_CONTEXT:-131072}
FLAGS=""

MODEL=$(gelli-model $MODEL)
LORAS=$(gelli-lora $LORAS)

if [ -n "$LORAS" ]; then
  for f in $LORAS; do FLAGS="$FLAGS --lora /lora/$f.gruf"; done
fi

exec llama-server --model "/models/$(basename "$MODEL").gguf" $FLAGS --port "$PORT" --ctx-size $CONTEXT
